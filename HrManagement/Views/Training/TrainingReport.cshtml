
@{
    ViewData["Title"] = "TrainingReport";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section PageCSS {


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet" />
    <link href="~/css/custom/trainingreport.css" rel="stylesheet" />

}
<style>
    a {
        text-decoration: none!important;
    }

    #deptChartCenter {
        padding-bottom: 70px!important;
    }

    #siteChartCenter {
        padding-bottom: 50px!important;
    }

    body {
        background: #f8f9fa;
        font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    .card {
        border-radius: 12px;
        box-shadow: 0 6px 20px rgba(15,23,42,0.06);
    }

    .accordion-button {
        font-weight: 500;
    }

    canvas {
        max-height: 350px;
        width: 100% !important;
    }

    table th, table td {
        font-size: 0.9rem;
    }
    .chart-card {
        min-height: 200px; /* smaller height */
        max-height: 250px; /* optional max height */
        padding: 15px;
    }

    canvas {
        max-height: 200px; /* limit canvas height */
        width: 100% !important;
    }
</style>




<div class="app-main flex-column flex-row-fluid" id="kt_app_main">
    <div class="d-flex flex-column flex-column-fluid">
        <div id="kt_app_toolbar" class="app-toolbar py-3 py-lg-6">
            <div id="kt_app_toolbar_container" class="app-container container-fluid d-flex flex-stack">
                <div class="page-title d-flex flex-column justify-content-center flex-wrap me-3">
                    <ul class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 my-0 pt-1">
                        <li class="breadcrumb-item">
                            <a href="/Home/Index" class="fw-bold fs-14px" style="color:#1F4293 !important">
                                <i class="fa fa-home" style="color:#1F4293 !important"></i> &nbsp;Home
                            </a>
                        </li>
                        <li class="breadcrumb-item">
                            <i class="fa fa-chevron-right fs-11px" style="color:#1F4293 !important"></i>
                        </li>
                        <li class="breadcrumb-item fs-14px fw-bold" style="color:#1F4293 !important" data-i18n="">
                            Training Reports
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div id="kt_app_content" class="app-content flex-column-fluid mt-4">
            <div id="kt_app_content_container" class="app-container container-fluid">
                <div class="container-fluid">
                    <h2 class="mb-4 text-center">📊 Training Reports Dashboard</h2>

                    <!-- Filters -->
                    <div class="card p-3 mb-4">
                        <div class="row g-3 align-items-end">
                            <div class="col-md-2">
                                <label class="form-label">Department</label>
                                <select id="filterDepartment" class="form-select"><option value="">All</option></select>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">SubDepartment</label>
                                <select id="filterSubDept" class="form-select"><option value="">All</option></select>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">Site</label>
                                <select id="filterSite" class="form-select"><option value="">All</option></select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Training</label>
                                <select id="filterTraining" class="form-select"><option value="">All</option></select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Employee</label>
                                <select id="filterEmployee" class="form-select"><option value="">All</option></select>
                            </div>
                        </div>
                    </div>
                    <!-- Top Charts -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <div class="card p-3 chart-card">
                                <h6 class="mb-2">Training Completion % by Employee</h6>
                                <canvas id="chartCompletion"></canvas>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card p-3 chart-card">
                                <h6 class="mb-2">Quiz Pass vs Fail per Training</h6>
                                <canvas id="chartPassFail"></canvas>
                            </div>
                        </div>
                    </div>
                    <!-- Grouped Charts -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <div class="card p-3 chart-card">
                                <h6 class="mb-2">Registered Employees by Department</h6>
                                <canvas id="chartDept"></canvas>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card p-3 chart-card">
                                <h6 class="mb-2">Registered Employees by SubDepartment</h6>
                                <canvas id="chartSubDept"></canvas>
                            </div>
                        </div>
                        <div class="col-md-6 mt-3">
                            <div class="card p-3 chart-card">
                                <h6 class="mb-2">Registered Employees by Site</h6>
                                <canvas id="chartSite"></canvas>
                            </div>
                        </div>
                        <div class="col-md-6 mt-3">
                            <div class="card p-3 chart-card">
                                <h6 class="mb-2">Registered Employees by Training</h6>
                                <canvas id="chartTraining"></canvas>
                            </div>
                        </div>
                    </div>
                    <!-- ==========================
                       Detailed Training Report
                     ========================== -->
                    <div class="card shadow-sm border-0 mb-4">
                        <div class="card-header bg-primary text-white py-2">
                            <h6 class="mb-0">📋 Detailed Training Report</h6>
                        </div>
                        <div class="card-body p-2">
                            <div class="table-responsive" style="max-height:400px; overflow-y:auto;">
                                <table class="table table-striped table-hover table-sm mb-0" id="flatTable">
                                    <thead class="table-light sticky-top">
                                        <tr>
                                            <th>Employee</th>
                                            <th>Department</th>
                                            <th>SubDept</th>
                                            <th>Site</th>
                                            <th>Training</th>
                                            <th>Course</th>
                                       
                                            <th>Completed</th>
                                            <th>Quiz Score</th>
                                            <th>Pass/Fail</th>
                                        </tr>
                                    </thead>
                                    <tbody id="detailedTrainingReport">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <!-- ==========================
                         Employee Registration Summary
                       ========================== -->
                    <div class="card shadow-sm border-0 mb-4">
                        <div class="card-header bg-success text-white py-2">
                            <h6 class="mb-0">👥 Employee Registration Summary</h6>
                        </div>
                        <div class="card-body p-3">
                            <div class="accordion" id="trainingSummaryAccordion"
                                 style="max-height:400px; overflow-y:auto; padding-right:10px;">
                                <!-- Dynamic content goes here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

    @section scripts{


    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>

    <script src="@Url.Content("/scripts/TrainingReport/index.js")" asp-append-version="true"></script>
    
   

}
<script>
     var DropDownsData = {};
      @if (ViewBag.DropDownData != null)
      {
         <text>
              DropDownsData = @(Html.Raw(Json.Serialize(ViewBag.DropDownData)))

         </text>

    }
</script>